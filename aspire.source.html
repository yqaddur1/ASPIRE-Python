<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>aspire.source package &mdash; ASPIRE 0.10.1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/sg_gallery.css" type="text/css" />
      <link rel="stylesheet" href="_static/sg_gallery-binder.css" type="text/css" />
      <link rel="stylesheet" href="_static/sg_gallery-dataframe.css" type="text/css" />
      <link rel="stylesheet" href="_static/sg_gallery-rendered-html.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="aspire.storage package" href="aspire.storage.html" />
    <link rel="prev" title="aspire.reconstruction package" href="aspire.reconstruction.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> ASPIRE
          </a>
              <div class="version">
                0.10.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">Modules</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="aspire.html">aspire package</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="aspire.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="aspire.abinitio.html">aspire.abinitio package</a></li>
<li class="toctree-l4"><a class="reference internal" href="aspire.apple.html">aspire.apple package</a></li>
<li class="toctree-l4"><a class="reference internal" href="aspire.basis.html">aspire.basis package</a></li>
<li class="toctree-l4"><a class="reference internal" href="aspire.classification.html">aspire.classification package</a></li>
<li class="toctree-l4"><a class="reference internal" href="aspire.commands.html">aspire.commands package</a></li>
<li class="toctree-l4"><a class="reference internal" href="aspire.covariance.html">aspire.covariance package</a></li>
<li class="toctree-l4"><a class="reference internal" href="aspire.ctf.html">aspire.ctf package</a></li>
<li class="toctree-l4"><a class="reference internal" href="aspire.denoising.html">aspire.denoising package</a></li>
<li class="toctree-l4"><a class="reference internal" href="aspire.image.html">aspire.image package</a></li>
<li class="toctree-l4"><a class="reference internal" href="aspire.noise.html">aspire.noise package</a></li>
<li class="toctree-l4"><a class="reference internal" href="aspire.nufft.html">aspire.nufft package</a></li>
<li class="toctree-l4"><a class="reference internal" href="aspire.numeric.html">aspire.numeric package</a></li>
<li class="toctree-l4"><a class="reference internal" href="aspire.operators.html">aspire.operators package</a></li>
<li class="toctree-l4"><a class="reference internal" href="aspire.optimization.html">aspire.optimization package</a></li>
<li class="toctree-l4"><a class="reference internal" href="aspire.reconstruction.html">aspire.reconstruction package</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">aspire.source package</a></li>
<li class="toctree-l4"><a class="reference internal" href="aspire.storage.html">aspire.storage package</a></li>
<li class="toctree-l4"><a class="reference internal" href="aspire.utils.html">aspire.utils package</a></li>
<li class="toctree-l4"><a class="reference internal" href="aspire.volume.html">aspire.volume package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="aspire.html#submodules">Submodules</a></li>
<li class="toctree-l3"><a class="reference internal" href="aspire.html#module-aspire.exceptions">aspire.exceptions module</a></li>
<li class="toctree-l3"><a class="reference internal" href="aspire.html#module-aspire">Module contents</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="authors.html">Authors</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Galleries:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="auto_tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="auto_experiments/index.html">Experiments</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ASPIRE</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="modules.html">Modules</a></li>
          <li class="breadcrumb-item"><a href="aspire.html">aspire package</a></li>
      <li class="breadcrumb-item active">aspire.source package</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/aspire.source.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="aspire-source-package">
<h1>aspire.source package<a class="headerlink" href="#aspire-source-package" title="Permalink to this headline">¶</a></h1>
<section id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
</section>
<section id="module-aspire.source.coordinates">
<span id="aspire-source-coordinates-module"></span><h2>aspire.source.coordinates module<a class="headerlink" href="#module-aspire.source.coordinates" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="aspire.source.coordinates.BoxesCoordinateSource">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">aspire.source.coordinates.</span></span><span class="sig-name descname"><span class="pre">BoxesCoordinateSource</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">files</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">particle_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_rows</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">B</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#aspire.source.coordinates.BoxesCoordinateSource" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#aspire.source.coordinates.CoordinateSource" title="aspire.source.coordinates.CoordinateSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">aspire.source.coordinates.CoordinateSource</span></code></a></p>
<p>Represents a data source consisting of micrographs and coordinate files
in box format.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>files</strong> – A list of tuples of the form (path_to_mrc, path_to_coord)</p></li>
<li><p><strong>max_rows</strong> – Maximum number of particles to read. (If <cite>None</cite>, will attempt to load all particles)</p></li>
</ul>
</dd>
<dt class="field-even">Particle_size</dt>
<dd class="field-even"><p>Desired size of cropped particles (will override the size specified in coordinate file)</p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="aspire.source.coordinates.CentersCoordinateSource">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">aspire.source.coordinates.</span></span><span class="sig-name descname"><span class="pre">CentersCoordinateSource</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">files</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">particle_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_rows</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">B</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#aspire.source.coordinates.CentersCoordinateSource" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#aspire.source.coordinates.CoordinateSource" title="aspire.source.coordinates.CoordinateSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">aspire.source.coordinates.CoordinateSource</span></code></a></p>
<p>Represents a data source consisting of micrographs and coordinate files specifying particle centers only. Files can be text (.coord) or STAR files.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>files</strong> – A list of tuples of the form (path_to_mrc, path_to_coord)</p></li>
<li><p><strong>max_rows</strong> – Maximum number of particles to read. (If <cite>None</cite>, will</p></li>
</ul>
</dd>
<dt class="field-even">Particle_size</dt>
<dd class="field-even"><p>Desired size of cropped particles (mandatory)</p>
</dd>
</dl>
<p>attempt to load all particles)</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="aspire.source.coordinates.CoordinateSource">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">aspire.source.coordinates.</span></span><span class="sig-name descname"><span class="pre">CoordinateSource</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">files</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">particle_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_rows</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">B</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#aspire.source.coordinates.CoordinateSource" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#aspire.source.image.ImageSource" title="aspire.source.image.ImageSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">aspire.source.image.ImageSource</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">abc.ABC</span></code></p>
<p>Base class defining common methods for data sources consisting of full
micrographs coupled with files specifying the locations of picked
particles in each micrograph.</p>
<p>Broadly, there are two ways this information is represented. Sometimes each
coordinate is simply the (X,Y) center location of the picked particle. This
is sometimes stored in a <cite>.coord</cite> text file, and sometimes in a STAR file.
The particle box is then computed using an externally supplied box size.
These sources may be loaded via the <cite>CentersCoordinateSource</cite> class for
both filetypes.</p>
<p>Other formats adhere to the box file specification, which
specifies a particle via four numbers:
(lower left X coordinate, lower left Y coordinate, X size, Y size).
These can be loaded via the <cite>BoxesCoordinateSource</cite> class.</p>
<p>Regardless of source, the coordinates of each particle are represented
internally in the box format.</p>
<p>Particle information is extracted from the micrographs and coordinate files
and put into a common data structure (self.particles).</p>
<p>The <cite>_images()</cite> method, called via <cite>ImageSource.images()</cite> crops
the particle images out of the micrograph and returns them as a stack.
This also allows the CoordinateSource to be saved to an <cite>.mrcs</cite> stack.</p>
<p>A Cryo-EM ImageSource object that supplies images along with other parameters for image manipulation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>L</strong> – resolution of (square) images (int)</p></li>
<li><p><strong>n</strong> – The total number of images available
Note that images() may return a different number of images based on its arguments.</p></li>
<li><p><strong>metadata</strong> – A Dataframe of metadata information corresponding to this ImageSource’s images</p></li>
<li><p><strong>memory</strong> – str or None
The path of the base directory to use as a data store or None. If None is given, no caching is performed.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="aspire.source.coordinates.CoordinateSource.import_ctf">
<span class="sig-name descname"><span class="pre">import_ctf</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ctf</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#aspire.source.coordinates.CoordinateSource.import_ctf" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a RELION CTF STAR file, or list of CTF STAR files–one for each micrograph–, this function adds
corresponding CTFFilter objects to the <cite>CoordinateSource</cite>’s unique
filter list, and also populates the metadata.</p>
</dd></dl>

</dd></dl>

</section>
<section id="module-aspire.source.image">
<span id="aspire-source-image-module"></span><h2>aspire.source.image module<a class="headerlink" href="#module-aspire.source.image" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="aspire.source.image.ArrayImageSource">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">aspire.source.image.</span></span><span class="sig-name descname"><span class="pre">ArrayImageSource</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metadata</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">angles</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#aspire.source.image.ArrayImageSource" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#aspire.source.image.ImageSource" title="aspire.source.image.ImageSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">aspire.source.image.ImageSource</span></code></a></p>
<p>An <cite>ImageSource</cite> object that holds a reference to an underlying <cite>Image</cite> object (a thin wrapper on an ndarray)
representing images. It does not produce its images on the fly, but keeps them in memory. As such, it should not be
used where large Image objects are involved, but can be used in situations where API conformity is desired.</p>
<p>Note that this class does not provide an <cite>_images</cite> method, since it populates the <cite>_cached_im</cite> attribute which,
if available, is consulted directly by the parent class, bypassing <cite>_images</cite>.</p>
<p>Initialize from an <cite>Image</cite> object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>im</strong> – An <cite>Image</cite> or Numpy array object representing image data served up by this <cite>ImageSource</cite>.
In the case of a Numpy array, attempts to create an ‘Image’ object.</p></li>
<li><p><strong>metadata</strong> – A Dataframe of metadata information corresponding to this ImageSource’s images</p></li>
<li><p><strong>angles</strong> – Optional n-by-3 array of rotation angles corresponding to <cite>im</cite>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="aspire.source.image.ImageSource">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">aspire.source.image.</span></span><span class="sig-name descname"><span class="pre">ImageSource</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">L</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'double'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metadata</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">memory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#aspire.source.image.ImageSource" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">abc.ABC</span></code></p>
<p>When creating an <cite>ImageSource</cite> object, a ‘metadata’ table holds metadata information about all images in the
<cite>ImageSource</cite>. The number of rows in this metadata table will equal the total number of images supported by this
<cite>ImageSource</cite> (available as the ‘n’ attribute), though reading/writing of images is usually done in chunks.</p>
<p>This metadata table is implemented as a pandas <cite>DataFrame</cite>.</p>
<p>The ‘values’ in this metadata table are usually primitive types (floats/ints/strings) that are suitable
for being read from STAR files, and being written to STAR files. The columns corresponding to these fields
begin with a single underscore ‘_’.</p>
<p>In addition, the metadata table may also contain references to Python objects.
<cite>Filter</cite> objects, for example, are stored in this metadata table as references to unique <cite>Filter</cite> objects that
correspond to images in this <cite>ImageSource</cite>. Several rows of metadata may end up containing a reference to a small
handful of unique <cite>Filter</cite> objects, depending on the values found in other columns (identical <cite>Filter</cite>
objects). For example, a smaller number of CTFFilter objects may apply to subsets of particles depending on
the unique “_rlnDefocusU”/”_rlnDefocusV” Relion parameters.</p>
<p>A Cryo-EM ImageSource object that supplies images along with other parameters for image manipulation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>L</strong> – resolution of (square) images (int)</p></li>
<li><p><strong>n</strong> – The total number of images available
Note that images() may return a different number of images based on its arguments.</p></li>
<li><p><strong>metadata</strong> – A Dataframe of metadata information corresponding to this ImageSource’s images</p></li>
<li><p><strong>memory</strong> – str or None
The path of the base directory to use as a data store or None. If None is given, no caching is performed.</p></li>
</ul>
</dd>
</dl>
<dl class="py property">
<dt class="sig sig-object py" id="aspire.source.image.ImageSource.amplitudes">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">amplitudes</span></span><a class="headerlink" href="#aspire.source.image.ImageSource.amplitudes" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="aspire.source.image.ImageSource.angles">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">angles</span></span><a class="headerlink" href="#aspire.source.image.ImageSource.angles" title="Permalink to this definition">¶</a></dt>
<dd><p>Rotation angles in radians.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Rotation angles in radians, as a n x 3 array</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="aspire.source.image.ImageSource.cache">
<span class="sig-name descname"><span class="pre">cache</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aspire.source.image.ImageSource.cache" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="aspire.source.image.ImageSource.downsample">
<span class="sig-name descname"><span class="pre">downsample</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">L</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#aspire.source.image.ImageSource.downsample" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="aspire.source.image.ImageSource.filter_indices">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">filter_indices</span></span><a class="headerlink" href="#aspire.source.image.ImageSource.filter_indices" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="aspire.source.image.ImageSource.get_metadata">
<span class="sig-name descname"><span class="pre">get_metadata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">metadata_fields</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">indices</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">default_value</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#aspire.source.image.ImageSource.get_metadata" title="Permalink to this definition">¶</a></dt>
<dd><p>Get metadata field information of this ImageSource for selected indices</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>metadata_fields</strong> – A string, of list of strings, representing the metadata field(s) to be queried.</p></li>
<li><p><strong>indices</strong> – A list of 0-based indices indicating the indices for which to get metadata.
If indices is None, then values corresponding to all indices in this Source object are returned.</p></li>
<li><p><strong>default_value</strong> – Default scalar value to use for any fields not found in the metadata. If None,
no default value is used, and missing field(s) cause a RuntimeError.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An ndarray of values (any valid np types) representing metadata info.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="aspire.source.image.ImageSource.has_metadata">
<span class="sig-name descname"><span class="pre">has_metadata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">metadata_fields</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#aspire.source.image.ImageSource.has_metadata" title="Permalink to this definition">¶</a></dt>
<dd><p>Find out if one more more metadata fields are available for this <cite>ImageSource</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>metadata_fields</strong> – A string, of list of strings, representing the metadata field(s) to be queried.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Boolean value indicating whether the field(s) are available.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="aspire.source.image.ImageSource.im_backward">
<span class="sig-name descname"><span class="pre">im_backward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#aspire.source.image.ImageSource.im_backward" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply adjoint mapping to set of images</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>im</strong> – An Image instance to which we wish to apply the adjoint of the forward model.</p></li>
<li><p><strong>start</strong> – Start index of image to consider</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An L-by-L-by-L volume containing the sum of the adjoint mappings applied to the start+num-1 images.</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="aspire.source.image.ImageSource.images">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">images</span></span><a class="headerlink" href="#aspire.source.image.ImageSource.images" title="Permalink to this definition">¶</a></dt>
<dd><p>Subscriptable property which returns the images contained in this source
corresponding to the indices given.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="aspire.source.image.ImageSource.invert_contrast">
<span class="sig-name descname"><span class="pre">invert_contrast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">batch_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">512</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#aspire.source.image.ImageSource.invert_contrast" title="Permalink to this definition">¶</a></dt>
<dd><p>invert the global contrast of images</p>
<p>Check if all images in a stack should be globally phase flipped so that
the molecule corresponds to brighter pixels and the background corresponds
to darker pixels. This is done by comparing the mean in a small circle
around the origin (supposed to correspond to the molecule) with the mean
of the noise, and making sure that the mean of the molecule is larger.
From the implementation level, we modify the <cite>ImageSource</cite> in-place by
appending a <cite>Multiple</cite> filter to the generation pipeline.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>batch_size</strong> – Batch size of images to query.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>On return, the <cite>ImageSource</cite> object has been modified in place.</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="aspire.source.image.ImageSource.n_ctf_filters">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">n_ctf_filters</span></span><a class="headerlink" href="#aspire.source.image.ImageSource.n_ctf_filters" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the number of CTFFilters found in this Source.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="aspire.source.image.ImageSource.normalize_background">
<span class="sig-name descname"><span class="pre">normalize_background</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bg_radius</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_ramp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#aspire.source.image.ImageSource.normalize_background" title="Permalink to this definition">¶</a></dt>
<dd><p>Normalize the images by the noise background</p>
<p>This is done by shifting the image density by the mean value of background
and scaling the image density by the standard deviation of background.
From the implementation level, we modify the <cite>ImageSource</cite> in-place by
appending the <cite>Add</cite> and <cite>Multiple</cite> filters to the generation pipeline.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>bg_radius</strong> – Radius cutoff to be considered as background (in image size)</p></li>
<li><p><strong>do_ramp</strong> – When it is <cite>True</cite>, fit a ramping background to the data
and subtract. Namely perform normalization based on values from each image.
Otherwise, a constant background level from all images is used.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>On return, the <cite>ImageSource</cite> object has been modified in place.</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="aspire.source.image.ImageSource.offsets">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">offsets</span></span><a class="headerlink" href="#aspire.source.image.ImageSource.offsets" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="aspire.source.image.ImageSource.phase_flip">
<span class="sig-name descname"><span class="pre">phase_flip</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aspire.source.image.ImageSource.phase_flip" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform phase flip on images in the source object using CTF information.
If no CTFFilters exist this will emit a warning and otherwise no-op.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="aspire.source.image.ImageSource.rotations">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">rotations</span></span><a class="headerlink" href="#aspire.source.image.ImageSource.rotations" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns rotation matrices.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Rotation matrices as a n x 3 x 3 array</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="aspire.source.image.ImageSource.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">starfile_filepath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">512</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overwrite</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#aspire.source.image.ImageSource.save" title="Permalink to this definition">¶</a></dt>
<dd><p>Save the output metadata to STAR file and/or images to MRCS file</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>starfile_filepath</strong> – Path to STAR file where we want to
save metadata of image_source</p></li>
<li><p><strong>batch_size</strong> – Batch size of images to query.</p></li>
<li><p><strong>save_mode</strong> – Whether to save all images in a single or multiple files in batch size.</p></li>
<li><p><strong>overwrite</strong> – Option to overwrite the output MRCS files.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A dictionary containing “starfile”–the path to the saved starfile– and “mrcs”, a
list of the saved particle stack .mrcs filenames.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="aspire.source.image.ImageSource.save_images">
<span class="sig-name descname"><span class="pre">save_images</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">starfile_filepath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename_indices</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">512</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overwrite</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#aspire.source.image.ImageSource.save_images" title="Permalink to this definition">¶</a></dt>
<dd><p>Save an ImageSource to MRCS files</p>
<p>Note that .mrcs files are saved at the same location as the STAR file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename_indices</strong> – Filename list for save all images</p></li>
<li><p><strong>starfile_filepath</strong> – Path to STAR file where we want to save image_source</p></li>
<li><p><strong>batch_size</strong> – Batch size of images to query from the <cite>ImageSource</cite> object.
if <cite>save_mode</cite> is not <cite>single</cite>, images in the same batch will save to one MRCS file.</p></li>
<li><p><strong>overwrite</strong> – Whether to overwrite any .mrcs files found at the target location.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="aspire.source.image.ImageSource.save_metadata">
<span class="sig-name descname"><span class="pre">save_metadata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">starfile_filepath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">512</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#aspire.source.image.ImageSource.save_metadata" title="Permalink to this definition">¶</a></dt>
<dd><p>Save updated metadata to a STAR file</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>starfile_filepath</strong> – Path to STAR file where we want to
save image_source</p></li>
<li><p><strong>batch_size</strong> – Batch size of images to query from the
<cite>ImageSource</cite> object. Every <cite>batch_size</cite> rows, entries are
written to STAR file.</p></li>
<li><p><strong>save_mode</strong> – Whether to save all images in a single or
multiple files in batch size.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="aspire.source.image.ImageSource.set_metadata">
<span class="sig-name descname"><span class="pre">set_metadata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">metadata_fields</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">values</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">indices</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#aspire.source.image.ImageSource.set_metadata" title="Permalink to this definition">¶</a></dt>
<dd><p>Modify metadata field information of this ImageSource for selected indices</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>metadata_fields</strong> – A string, or list of strings, representing the metadata field(s) to be modified</p></li>
<li><p><strong>values</strong> – A scalar or vector (of length <a href="#id1"><span class="problematic" id="id2">|indices|</span></a>) of replacement values.</p></li>
<li><p><strong>indices</strong> – A list of 0-based indices indicating the indices for which to modify metadata.
If indices is None, then all indices in this Source object are modified. In this case,
values should either be a scalar or a vector of length equal to the total number of images, <a href="#id3"><span class="problematic" id="id4">|self.n|</span></a>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>On return, the metadata associated with the specified indices has been modified.</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="aspire.source.image.ImageSource.states">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">states</span></span><a class="headerlink" href="#aspire.source.image.ImageSource.states" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="aspire.source.image.ImageSource.vol_forward">
<span class="sig-name descname"><span class="pre">vol_forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#aspire.source.image.ImageSource.vol_forward" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply forward image model to volume</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>vol</strong> – A volume instance.</p></li>
<li><p><strong>start</strong> – Start index of image to consider</p></li>
<li><p><strong>num</strong> – Number of images to consider</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The images obtained from volume by projecting, applying CTFs, translating, and multiplying by the
amplitude.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="aspire.source.image.ImageSource.whiten">
<span class="sig-name descname"><span class="pre">whiten</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">noise_filter</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#aspire.source.image.ImageSource.whiten" title="Permalink to this definition">¶</a></dt>
<dd><p>Modify the <cite>ImageSource</cite> in-place by appending a whitening filter to the generation pipeline.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>noise_filter</strong> – The noise psd of the images as a <cite>Filter</cite> object. Typically determined by a
NoiseEstimator class, and available as its <cite>filter</cite> attribute.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>On return, the <cite>ImageSource</cite> object has been modified in place.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="module-aspire.source.relion">
<span id="aspire-source-relion-module"></span><h2>aspire.source.relion module<a class="headerlink" href="#module-aspire.source.relion" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="aspire.source.relion.RelionSource">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">aspire.source.relion.</span></span><span class="sig-name descname"><span class="pre">RelionSource</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filepath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_folder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pixel_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">B</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_workers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-</span> <span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_rows</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">memory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#aspire.source.relion.RelionSource" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#aspire.source.image.ImageSource" title="aspire.source.image.ImageSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">aspire.source.image.ImageSource</span></code></a></p>
<p>A RelionSource represents a source of picked and cropped particles stored as slices in a <cite>.mrcs</cite> stack.
It must be instantiated via a STAR file, which–at a minumum–lists the particles in each <cite>.mrcs</cite> stack in the
<cite>_rlnImageName</cite> column. The STAR file may also contain Relion-specific metadata columns. This information
is read into a Pandas DataFrame table containing a row for each particle specifying its location and
its metadata. The metadata table may be augmented or modified via helper methods found in ImageSource. It may
store, for example, Filter objects added during preprocessing.</p>
<p>Load STAR file at given filepath</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filepath</strong> – Absolute or relative path to STAR file</p></li>
<li><p><strong>data_folder</strong> – Path to folder w.r.t which all relative paths to .mrcs files are resolved.
If None, the folder corresponding to filepath is used.</p></li>
<li><p><strong>pixel_size</strong> – the pixel size of the images in angstroms (Default 1)</p></li>
<li><p><strong>B</strong> – the envelope decay of the CTF in inverse square angstrom (Default 0)</p></li>
<li><p><strong>n_workers</strong> – Number of threads to spawn to read referenced .mrcs files (Default -1 to auto detect)</p></li>
<li><p><strong>max_rows</strong> – Maximum number of rows in STAR file to read. If None, all rows are read.
Note that this refers to the max number of images to load, not the max. number of .mrcs files (which may be
equal to or less than the number of images).</p></li>
<li><p><strong>memory</strong> – str or None
The path of the base directory to use as a data store or None. If None is given, no caching is performed.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="aspire.source.relion.RelionSource.populate_metadata">
<span class="sig-name descname"><span class="pre">populate_metadata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filepath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_folder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_rows</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#aspire.source.relion.RelionSource.populate_metadata" title="Permalink to this definition">¶</a></dt>
<dd><p>Relion STAR files may contain a large number of metadata columns in addition
to the locations of particles. We read this into a Pandas DataFrame and add some of
our own columns for convenience.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="aspire.source.relion.RelionSource.relion_metadata_fields">
<span class="sig-name descname"><span class="pre">relion_metadata_fields</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">{'_rlnAmplitudeContrast':</span> <span class="pre">&lt;class</span> <span class="pre">'float'&gt;,</span> <span class="pre">'_rlnAnglePsi':</span> <span class="pre">&lt;class</span> <span class="pre">'float'&gt;,</span> <span class="pre">'_rlnAngleRot':</span> <span class="pre">&lt;class</span> <span class="pre">'float'&gt;,</span> <span class="pre">'_rlnAngleTilt':</span> <span class="pre">&lt;class</span> <span class="pre">'float'&gt;,</span> <span class="pre">'_rlnClassNumber':</span> <span class="pre">&lt;class</span> <span class="pre">'int'&gt;,</span> <span class="pre">'_rlnCoordinateX':</span> <span class="pre">&lt;class</span> <span class="pre">'float'&gt;,</span> <span class="pre">'_rlnCoordinateY':</span> <span class="pre">&lt;class</span> <span class="pre">'float'&gt;,</span> <span class="pre">'_rlnCoordinateZ':</span> <span class="pre">&lt;class</span> <span class="pre">'float'&gt;,</span> <span class="pre">'_rlnCtfFigureOfMerit':</span> <span class="pre">&lt;class</span> <span class="pre">'float'&gt;,</span> <span class="pre">'_rlnCtfImage':</span> <span class="pre">&lt;class</span> <span class="pre">'str'&gt;,</span> <span class="pre">'_rlnDefocusAngle':</span> <span class="pre">&lt;class</span> <span class="pre">'float'&gt;,</span> <span class="pre">'_rlnDefocusU':</span> <span class="pre">&lt;class</span> <span class="pre">'float'&gt;,</span> <span class="pre">'_rlnDefocusV':</span> <span class="pre">&lt;class</span> <span class="pre">'float'&gt;,</span> <span class="pre">'_rlnDetectorPixelSize':</span> <span class="pre">&lt;class</span> <span class="pre">'float'&gt;,</span> <span class="pre">'_rlnGroupName':</span> <span class="pre">&lt;class</span> <span class="pre">'str'&gt;,</span> <span class="pre">'_rlnGroupNumber':</span> <span class="pre">&lt;class</span> <span class="pre">'str'&gt;,</span> <span class="pre">'_rlnImageName':</span> <span class="pre">&lt;class</span> <span class="pre">'str'&gt;,</span> <span class="pre">'_rlnLogLikeliContribution':</span> <span class="pre">&lt;class</span> <span class="pre">'float'&gt;,</span> <span class="pre">'_rlnMagnification':</span> <span class="pre">&lt;class</span> <span class="pre">'float'&gt;,</span> <span class="pre">'_rlnMaxValueProbDistribution':</span> <span class="pre">&lt;class</span> <span class="pre">'float'&gt;,</span> <span class="pre">'_rlnMicrographName':</span> <span class="pre">&lt;class</span> <span class="pre">'str'&gt;,</span> <span class="pre">'_rlnNormCorrection':</span> <span class="pre">&lt;class</span> <span class="pre">'float'&gt;,</span> <span class="pre">'_rlnNrOfFrames':</span> <span class="pre">&lt;class</span> <span class="pre">'int'&gt;,</span> <span class="pre">'_rlnNrOfSignificantSamples':</span> <span class="pre">&lt;class</span> <span class="pre">'float'&gt;,</span> <span class="pre">'_rlnOriginX':</span> <span class="pre">&lt;class</span> <span class="pre">'float'&gt;,</span> <span class="pre">'_rlnOriginY':</span> <span class="pre">&lt;class</span> <span class="pre">'float'&gt;,</span> <span class="pre">'_rlnOriginalName':</span> <span class="pre">&lt;class</span> <span class="pre">'str'&gt;,</span> <span class="pre">'_rlnOriginalParticleName':</span> <span class="pre">&lt;class</span> <span class="pre">'str'&gt;,</span> <span class="pre">'_rlnParticleName':</span> <span class="pre">&lt;class</span> <span class="pre">'str'&gt;,</span> <span class="pre">'_rlnRandomSubset':</span> <span class="pre">&lt;class</span> <span class="pre">'int'&gt;,</span> <span class="pre">'_rlnSphericalAberration':</span> <span class="pre">&lt;class</span> <span class="pre">'float'&gt;,</span> <span class="pre">'_rlnVoltage':</span> <span class="pre">&lt;class</span> <span class="pre">'float'&gt;}</span></em><a class="headerlink" href="#aspire.source.relion.RelionSource.relion_metadata_fields" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</section>
<section id="module-aspire.source.simulation">
<span id="aspire-source-simulation-module"></span><h2>aspire.source.simulation module<a class="headerlink" href="#module-aspire.source.simulation" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="aspire.source.simulation.Simulation">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">aspire.source.simulation.</span></span><span class="sig-name descname"><span class="pre">Simulation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">L</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1024</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vols</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">states</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">unique_filters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filter_indices</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">offsets</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">amplitudes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">C</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">angles</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">memory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noise_adder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#aspire.source.simulation.Simulation" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#aspire.source.image.ImageSource" title="aspire.source.image.ImageSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">aspire.source.image.ImageSource</span></code></a></p>
<p>A <cite>Simulation</cite> represents a synthetic dataset of realistic cryo-EM images with corresponding
<cite>metadata</cite>. The images are generated via projections of a supplied <cite>Volume</cite> object, <cite>vols</cite>, over
orientations define by the Euler angles, <cite>angles</cite>. Various types of corruption, such as noise and
CTF effects, can be added to the images by supplying a <cite>Filter</cite> object to the <cite>noise_filter</cite> or
<cite>unique_filters</cite> arguments.</p>
<p>A <cite>Simulation</cite> object that supplies images along with other parameters for image manipulation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>L</strong> – Resolution of projection images (integer). Default is 8.
If a <cite>Volume</cite> is provided <cite>L</cite> and <cite>vols.resolution</cite> must agree.</p></li>
<li><p><strong>n</strong> – The number of images to generate (integer).</p></li>
<li><p><strong>vols</strong> – A <cite>Volume</cite> object representing a stack of volumes.
Default is generated with <cite>volume.volume_synthesis.LegacyVolume</cite>.</p></li>
<li><p><strong>states</strong> – A 1d array of n integers in the interval [0, C). The i’th integer indicates
the volume stack index used to produce the i’th projection image. Default is a random set.</p></li>
<li><p><strong>unique_filters</strong> – A list of Filter objects to be applied to projection images.</p></li>
<li><p><strong>filter_indices</strong> – A 1d array of n integers indicating the <cite>unique_filter</cite> indices associated
with each image. Default is a random set of filter indices, .ie the filters from <cite>unique_filters</cite>
are randomly assigned to the stack of images.</p></li>
<li><p><strong>offsets</strong> – A n-by-2 array of coordinates to offset the images. Default is a normally
distributed set of offsets. Set <cite>offsets = 0</cite> to disable offsets.</p></li>
<li><p><strong>amplitude</strong> – A 1d array of n amplitudes to scale the projection images. Default is
a random set in the interval [2/3, 3/2]. Set <cite>amplitude = 1</cite> to disable amplitudes.</p></li>
<li><p><strong>dtype</strong> – dtype for the Simulation</p></li>
<li><p><strong>C</strong> – Number of Volumes used to generate projection images. The default is C=2.
If a <cite>Volume</cite> object is provided this parameter is overridden and <cite>self.C</cite> = <cite>self.vols.n_vols</cite>.</p></li>
<li><p><strong>angles</strong> – A n-by-3 array of Euler angles for use in projection. Default is a random set.</p></li>
<li><p><strong>seed</strong> – Random seed.</p></li>
<li><p><strong>memory</strong> – str or None. The path of the base directory to use as a data store or None.
If None is given, no caching is performed.</p></li>
<li><p><strong>noise_adder</strong> – Optionally append instance of <cite>NoiseAdder</cite>
to generation pipeline.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A Simulation object.</p>
</dd>
</dl>
<dl class="py property">
<dt class="sig sig-object py" id="aspire.source.simulation.Simulation.clean_images">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">clean_images</span></span><a class="headerlink" href="#aspire.source.simulation.Simulation.clean_images" title="Permalink to this definition">¶</a></dt>
<dd><p>Return projections with filters/shifts/amplitudes applied, but without noise.
Subscriptable property.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="aspire.source.simulation.Simulation.covar_true">
<span class="sig-name descname"><span class="pre">covar_true</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aspire.source.simulation.Simulation.covar_true" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="aspire.source.simulation.Simulation.eigs">
<span class="sig-name descname"><span class="pre">eigs</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aspire.source.simulation.Simulation.eigs" title="Permalink to this definition">¶</a></dt>
<dd><p>Eigendecomposition of volume covariance matrix of simulation
:return: A 2-tuple:</p>
<blockquote>
<div><p>eigs_true: The eigenvectors of the volume covariance matrix in the form of Volume instance.
lambdas_true: The eigenvalues of the covariance matrix in the form of a (C-1)-by-(C-1) diagonal matrix.</p>
</div></blockquote>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="aspire.source.simulation.Simulation.eval_clustering">
<span class="sig-name descname"><span class="pre">eval_clustering</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vol_idx</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#aspire.source.simulation.Simulation.eval_clustering" title="Permalink to this definition">¶</a></dt>
<dd><p>Evaluate clustering estimation</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>vol_idx</strong> – Indexes of the volumes determined (0-indexed)</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Accuracy [0-1] in terms of proportion of correctly assigned labels</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="aspire.source.simulation.Simulation.eval_coords">
<span class="sig-name descname"><span class="pre">eval_coords</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mean_vol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eig_vols</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coords_est</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#aspire.source.simulation.Simulation.eval_coords" title="Permalink to this definition">¶</a></dt>
<dd><p>Evaluate coordinate estimation</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mean_vol</strong> – A mean volume in the form of a Volume instance.</p></li>
<li><p><strong>eig_vols</strong> – A set of eigenvolumes in an Volume instance.</p></li>
<li><p><strong>coords_est</strong> – The estimated coordinates in the affine space defined centered at <cite>mean_vol</cite> and spanned
by <cite>eig_vols</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="aspire.source.simulation.Simulation.eval_covar">
<span class="sig-name descname"><span class="pre">eval_covar</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">covar_est</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#aspire.source.simulation.Simulation.eval_covar" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="aspire.source.simulation.Simulation.eval_eigs">
<span class="sig-name descname"><span class="pre">eval_eigs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">eigs_est</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lambdas_est</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#aspire.source.simulation.Simulation.eval_eigs" title="Permalink to this definition">¶</a></dt>
<dd><p>Evaluate covariance eigendecomposition accuracy</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>eigs_est</strong> – The estimated volume eigenvectors in an L-by-L-by-L-by-K array.</p></li>
<li><p><strong>lambdas_est</strong> – The estimated eigenvalues in a K-by-K diagonal matrix (default <cite>diag(ones(K, 1))</cite>).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="aspire.source.simulation.Simulation.eval_mean">
<span class="sig-name descname"><span class="pre">eval_mean</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mean_est</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#aspire.source.simulation.Simulation.eval_mean" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="aspire.source.simulation.Simulation.eval_vol">
<span class="sig-name descname"><span class="pre">eval_vol</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vol_true</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vol_est</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#aspire.source.simulation.Simulation.eval_vol" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="aspire.source.simulation.Simulation.eval_volmat">
<span class="sig-name descname"><span class="pre">eval_volmat</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">volmat_true</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">volmat_est</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#aspire.source.simulation.Simulation.eval_volmat" title="Permalink to this definition">¶</a></dt>
<dd><p>Evaluate volume matrix estimation accuracy</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>volmat_true</strong> – The true volume matrices in the form of an L-by-L-by-L-by-L-by-L-by-L-by-K array.</p></li>
<li><p><strong>volmat_est</strong> – The estimated volume matrices in the same form.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="aspire.source.simulation.Simulation.mean_true">
<span class="sig-name descname"><span class="pre">mean_true</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aspire.source.simulation.Simulation.mean_true" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="aspire.source.simulation.Simulation.projections">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">projections</span></span><a class="headerlink" href="#aspire.source.simulation.Simulation.projections" title="Permalink to this definition">¶</a></dt>
<dd><p>Return projections of generated volumes, without applying filters/shifts/amplitudes/noise</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>start</strong> – start index (0-indexed) of the start image to return</p></li>
<li><p><strong>num</strong> – Number of images to return. If None, <em>all</em> images are returned.</p></li>
<li><p><strong>indices</strong> – A numpy array of image indices. If specified, start and num are ignored.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An Image instance.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="aspire.source.simulation.Simulation.vol_coords">
<span class="sig-name descname"><span class="pre">vol_coords</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mean_vol</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eig_vols</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#aspire.source.simulation.Simulation.vol_coords" title="Permalink to this definition">¶</a></dt>
<dd><p>Coordinates of simulation volumes in a given basis</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mean_vol</strong> – A mean volume in the form of a Volume Instance (default <cite>mean_true</cite>).</p></li>
<li><p><strong>eig_vols</strong> – A set of k volumes in a Volume instance (default <cite>eigs</cite>).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="module-aspire.source">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-aspire.source" title="Permalink to this headline">¶</a></h2>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="aspire.reconstruction.html" class="btn btn-neutral float-left" title="aspire.reconstruction package" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="aspire.storage.html" class="btn btn-neutral float-right" title="aspire.storage package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Princeton University.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>