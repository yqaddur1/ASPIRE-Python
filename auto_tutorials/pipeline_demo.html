<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ab-initio Pipeline Demonstration &mdash; ASPIRE 0.10.1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sg_gallery.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sg_gallery-binder.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sg_gallery-dataframe.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sg_gallery-rendered-html.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Apple Picker" href="apple_picker.html" />
    <link rel="prev" title="ASPIRE-Python Introduction" href="lecture_feature_demo.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> ASPIRE
          </a>
              <div class="version">
                0.10.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../authors.html">Authors</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Galleries:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="cov2d_simulation.html">2D Covariance Estimation</a></li>
<li class="toctree-l2"><a class="reference internal" href="orient3d_simulation.html">3D Image Orientation</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html">ASPIRE Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="image_class.html">ASPIRE Image Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="lecture_feature_demo.html">ASPIRE-Python Introduction</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Ab-initio Pipeline Demonstration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#download-a-volume">Download a Volume</a></li>
<li class="toctree-l3"><a class="reference internal" href="#load-a-volume">Load a Volume</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-a-simulation-source">Create a Simulation Source</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#noise-and-ctf-filters">Noise and CTF Filters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#initialize-simulation-object">Initialize Simulation Object</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#several-views-of-the-projection-images">Several Views of the Projection Images</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ctf-correction">CTF Correction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#class-averaging">Class Averaging</a></li>
<li class="toctree-l3"><a class="reference internal" href="#view-the-class-averages">View the Class Averages</a></li>
<li class="toctree-l3"><a class="reference internal" href="#orientation-estimation">Orientation Estimation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mean-squared-error">Mean Squared Error</a></li>
<li class="toctree-l3"><a class="reference internal" href="#volume-reconstruction">Volume Reconstruction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#comparison-of-estimated-volume-with-source-volume">Comparison of Estimated Volume with Source Volume</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="apple_picker.html">Apple Picker</a></li>
<li class="toctree-l2"><a class="reference internal" href="basic_image_array.html">Basic Image Array</a></li>
<li class="toctree-l2"><a class="reference internal" href="class_averaging.html">Class Averaging</a></li>
<li class="toctree-l2"><a class="reference internal" href="cov3d_simulation.html">Covariance 3D Estimation</a></li>
<li class="toctree-l2"><a class="reference internal" href="generating_volume_projections.html">Generating 3D Volume Projections</a></li>
<li class="toctree-l2"><a class="reference internal" href="image_expansion.html">Image Expansion</a></li>
<li class="toctree-l2"><a class="reference internal" href="preprocess_imgs_sim.html">Image Preprocessing</a></li>
<li class="toctree-l2"><a class="reference internal" href="starfile.html">Starfile</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../auto_experiments/index.html">Experiments</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ASPIRE</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Tutorials</a></li>
      <li class="breadcrumb-item active">Ab-initio Pipeline Demonstration</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/auto_tutorials/pipeline_demo.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-auto-tutorials-pipeline-demo-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="ab-initio-pipeline-demonstration">
<span id="sphx-glr-auto-tutorials-pipeline-demo-py"></span><h1>Ab-initio Pipeline Demonstration<a class="headerlink" href="#ab-initio-pipeline-demonstration" title="Permalink to this headline">¶</a></h1>
<p>This tutorial demonstrates some key components of an ab-initio reconstruction pipeline using
synthetic data generated with ASPIRE’s <code class="docutils literal notranslate"><span class="pre">Simulation</span></code> class of objects.</p>
<section id="download-a-volume">
<h2>Download a Volume<a class="headerlink" href="#download-a-volume" title="Permalink to this headline">¶</a></h2>
<p>We begin by downloading a high resolution volume map of the 80S Ribosome, sourced from
EMDB: <a class="reference external" href="https://www.ebi.ac.uk/emdb/EMD-2660">https://www.ebi.ac.uk/emdb/EMD-2660</a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">requests</span>


<span class="c1"># Download volume</span>
<span class="k">def</span> <span class="nf">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">save_path</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">):</span>
            <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>


<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;data/emd_2660.map&quot;</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://ftp.ebi.ac.uk/pub/databases/emdb/structures/EMD-2660/map/emd_2660.map.gz&quot;</span>
    <span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;data/emd_2660.map&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="load-a-volume">
<h2>Load a Volume<a class="headerlink" href="#load-a-volume" title="Permalink to this headline">¶</a></h2>
<p>We use ASPIRE’s <code class="docutils literal notranslate"><span class="pre">Volume</span></code> class to load and downsample the volume.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aspire.volume</span> <span class="kn">import</span> <span class="n">Volume</span>

<span class="c1"># Load 80s Ribosome</span>
<span class="n">original_vol</span> <span class="o">=</span> <span class="n">Volume</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;data/emd_2660.map&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="c1"># Downsample the volume</span>
<span class="n">res</span> <span class="o">=</span> <span class="mi">41</span>
<span class="n">vol</span> <span class="o">=</span> <span class="n">original_vol</span><span class="o">.</span><span class="n">downsample</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A <code class="docutils literal notranslate"><span class="pre">Volume</span></code> can be saved using the <code class="docutils literal notranslate"><span class="pre">Volume.save()</span></code> method as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;downsampled_80s_ribosome_size</span><span class="si">{</span><span class="n">res</span><span class="si">}</span><span class="s2">.mrc&quot;</span>
<span class="n">vol</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="create-a-simulation-source">
<h2>Create a Simulation Source<a class="headerlink" href="#create-a-simulation-source" title="Permalink to this headline">¶</a></h2>
<p>ASPIRE’s <code class="docutils literal notranslate"><span class="pre">Simulation</span></code> class can be used to generate a synthetic dataset of projection images.
A <code class="docutils literal notranslate"><span class="pre">Simulation</span></code> object produces random projections of a supplied Volume and applies noise and
CTF filters. The resulting stack of 2D images is stored in an <code class="docutils literal notranslate"><span class="pre">Image</span></code> object.</p>
<section id="noise-and-ctf-filters">
<h3>Noise and CTF Filters<a class="headerlink" href="#noise-and-ctf-filters" title="Permalink to this headline">¶</a></h3>
<p>Let’s start by creating noise and CTF filters. The <code class="docutils literal notranslate"><span class="pre">operators</span></code> package contains a collection
of filter classes that can be supplied to a <code class="docutils literal notranslate"><span class="pre">Simulation</span></code>. We use <code class="docutils literal notranslate"><span class="pre">ScalarFilter</span></code> to create
Gaussian white noise and <code class="docutils literal notranslate"><span class="pre">RadialCTFFilter</span></code> to generate a set of CTF filters with various defocus values.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create noise and CTF filters</span>
<span class="kn">from</span> <span class="nn">aspire.noise</span> <span class="kn">import</span> <span class="n">WhiteNoiseAdder</span>
<span class="kn">from</span> <span class="nn">aspire.operators</span> <span class="kn">import</span> <span class="n">RadialCTFFilter</span>

<span class="c1"># Gaussian noise filter.</span>
<span class="c1"># Note, the value supplied to the ``WhiteNoiseAdder``, chosen based on other parameters</span>
<span class="c1"># for this quick tutorial, can be changed to adjust the power of the noise.</span>
<span class="n">noise_adder</span> <span class="o">=</span> <span class="n">WhiteNoiseAdder</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)</span>

<span class="c1"># Radial CTF Filter</span>
<span class="n">defocus_min</span> <span class="o">=</span> <span class="mi">15000</span>  <span class="c1"># unit is angstroms</span>
<span class="n">defocus_max</span> <span class="o">=</span> <span class="mi">25000</span>
<span class="n">defocus_ct</span> <span class="o">=</span> <span class="mi">7</span>

<span class="n">ctf_filters</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">RadialCTFFilter</span><span class="p">(</span><span class="n">pixel_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">defocus</span><span class="o">=</span><span class="n">d</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">defocus_min</span><span class="p">,</span> <span class="n">defocus_max</span><span class="p">,</span> <span class="n">defocus_ct</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
<section id="initialize-simulation-object">
<h3>Initialize Simulation Object<a class="headerlink" href="#initialize-simulation-object" title="Permalink to this headline">¶</a></h3>
<p>We feed our <code class="docutils literal notranslate"><span class="pre">Volume</span></code> and filters into <code class="docutils literal notranslate"><span class="pre">Simulation</span></code> to generate the dataset of images.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aspire.source</span> <span class="kn">import</span> <span class="n">Simulation</span>

<span class="c1"># set parameters</span>
<span class="n">res</span> <span class="o">=</span> <span class="mi">41</span>
<span class="n">n_imgs</span> <span class="o">=</span> <span class="mi">2500</span>

<span class="c1"># For this ``Simulation`` we set all 2D offset vectors to zero,</span>
<span class="c1"># but by default offset vectors will be randomly distributed.</span>
<span class="n">src</span> <span class="o">=</span> <span class="n">Simulation</span><span class="p">(</span>
    <span class="n">L</span><span class="o">=</span><span class="n">res</span><span class="p">,</span>  <span class="c1"># resolution</span>
    <span class="n">n</span><span class="o">=</span><span class="n">n_imgs</span><span class="p">,</span>  <span class="c1"># number of projections</span>
    <span class="n">vols</span><span class="o">=</span><span class="n">vol</span><span class="p">,</span>  <span class="c1"># volume source</span>
    <span class="n">offsets</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_imgs</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>  <span class="c1"># Default: images are randomly shifted</span>
    <span class="n">noise_adder</span><span class="o">=</span><span class="n">noise_adder</span><span class="p">,</span>
    <span class="n">unique_filters</span><span class="o">=</span><span class="n">ctf_filters</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="several-views-of-the-projection-images">
<h2>Several Views of the Projection Images<a class="headerlink" href="#several-views-of-the-projection-images" title="Permalink to this headline">¶</a></h2>
<p>We can access several views of the projection images.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># with no corruption applied</span>
<span class="n">src</span><span class="o">.</span><span class="n">projections</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_pipeline_demo_001.png" srcset="../_images/sphx_glr_pipeline_demo_001.png" alt="pipeline demo" class = "sphx-glr-single-img"/><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># with no noise corruption</span>
<span class="n">src</span><span class="o">.</span><span class="n">clean_images</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_pipeline_demo_002.png" srcset="../_images/sphx_glr_pipeline_demo_002.png" alt="pipeline demo" class = "sphx-glr-single-img"/><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># with noise and CTF corruption</span>
<span class="n">src</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_pipeline_demo_003.png" srcset="../_images/sphx_glr_pipeline_demo_003.png" alt="pipeline demo" class = "sphx-glr-single-img"/></section>
<section id="ctf-correction">
<h2>CTF Correction<a class="headerlink" href="#ctf-correction" title="Permalink to this headline">¶</a></h2>
<p>We apply <code class="docutils literal notranslate"><span class="pre">phase_flip()</span></code> to correct for CTF effects.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">src</span><span class="o">.</span><span class="n">phase_flip</span><span class="p">()</span>
<span class="n">src</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_pipeline_demo_004.png" srcset="../_images/sphx_glr_pipeline_demo_004.png" alt="pipeline demo" class = "sphx-glr-single-img"/></section>
<section id="class-averaging">
<h2>Class Averaging<a class="headerlink" href="#class-averaging" title="Permalink to this headline">¶</a></h2>
<p>We use <code class="docutils literal notranslate"><span class="pre">RIRClass2D</span></code> object to classify the images via the rotationally invariant
representation (RIR) algorithm. Class selection is customizable. The classification module
also includes a set of protocols for selecting a set of images to be used for classification.
Here we’re using <code class="docutils literal notranslate"><span class="pre">TopClassSelector</span></code>, which selects the first <code class="docutils literal notranslate"><span class="pre">n_classes</span></code> images from the source.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aspire.classification</span> <span class="kn">import</span> <span class="n">RIRClass2D</span><span class="p">,</span> <span class="n">TopClassSelector</span>

<span class="c1"># set parameters</span>
<span class="n">n_classes</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">n_nbor</span> <span class="o">=</span> <span class="mi">6</span>

<span class="c1"># Create a class averaging instance. Note that the ``fspca_components`` and</span>
<span class="c1"># ``bispectrum_components`` were selected for this small tutorial.</span>
<span class="n">rir</span> <span class="o">=</span> <span class="n">RIRClass2D</span><span class="p">(</span>
    <span class="n">src</span><span class="p">,</span>
    <span class="n">fspca_components</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
    <span class="n">bispectrum_components</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
    <span class="n">n_nbor</span><span class="o">=</span><span class="n">n_nbor</span><span class="p">,</span>
    <span class="n">n_classes</span><span class="o">=</span><span class="n">n_classes</span><span class="p">,</span>
    <span class="n">selector</span><span class="o">=</span><span class="n">TopClassSelector</span><span class="p">(),</span>
    <span class="n">num_procs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># Change to &quot;auto&quot; if your machine has many processors</span>
<span class="p">)</span>

<span class="c1"># classify and average</span>
<span class="n">classes</span><span class="p">,</span> <span class="n">reflections</span><span class="p">,</span> <span class="n">distances</span> <span class="o">=</span> <span class="n">rir</span><span class="o">.</span><span class="n">classify</span><span class="p">()</span>
<span class="n">avgs</span> <span class="o">=</span> <span class="n">rir</span><span class="o">.</span><span class="n">averages</span><span class="p">(</span><span class="n">classes</span><span class="p">,</span> <span class="n">reflections</span><span class="p">,</span> <span class="n">distances</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/5 [00:00&lt;?, ?it/s]
 20%|##        | 1/5 [00:01&lt;00:07,  1.95s/it]
 40%|####      | 2/5 [00:03&lt;00:05,  1.94s/it]
 60%|######    | 3/5 [00:05&lt;00:03,  1.94s/it]
 80%|########  | 4/5 [00:07&lt;00:01,  1.94s/it]
100%|##########| 5/5 [00:09&lt;00:00,  1.86s/it]
100%|##########| 5/5 [00:09&lt;00:00,  1.90s/it]

  0%|          | 0/5 [00:00&lt;?, ?it/s]
 20%|##        | 1/5 [00:00&lt;00:01,  3.76it/s]
 40%|####      | 2/5 [00:00&lt;00:00,  3.77it/s]
 60%|######    | 3/5 [00:00&lt;00:00,  3.81it/s]
 80%|########  | 4/5 [00:01&lt;00:00,  3.80it/s]
100%|##########| 5/5 [00:01&lt;00:00,  4.00it/s]
100%|##########| 5/5 [00:01&lt;00:00,  3.90it/s]

  0%|          | 0/200 [00:00&lt;?, ?it/s]
  0%|          | 1/200 [00:01&lt;05:05,  1.53s/it]
  1%|1         | 2/200 [00:02&lt;04:50,  1.47s/it]
  2%|1         | 3/200 [00:04&lt;04:45,  1.45s/it]
  2%|2         | 4/200 [00:05&lt;04:41,  1.43s/it]
  2%|2         | 5/200 [00:07&lt;04:38,  1.43s/it]
  3%|3         | 6/200 [00:08&lt;04:36,  1.42s/it]
  4%|3         | 7/200 [00:10&lt;04:34,  1.42s/it]
  4%|4         | 8/200 [00:11&lt;04:32,  1.42s/it]
  4%|4         | 9/200 [00:12&lt;04:30,  1.42s/it]
  5%|5         | 10/200 [00:14&lt;04:29,  1.42s/it]
  6%|5         | 11/200 [00:15&lt;04:28,  1.42s/it]
  6%|6         | 12/200 [00:17&lt;04:26,  1.42s/it]
  6%|6         | 13/200 [00:18&lt;04:24,  1.42s/it]
  7%|7         | 14/200 [00:19&lt;04:23,  1.42s/it]
  8%|7         | 15/200 [00:21&lt;04:22,  1.42s/it]
  8%|8         | 16/200 [00:22&lt;04:20,  1.42s/it]
  8%|8         | 17/200 [00:24&lt;04:19,  1.42s/it]
  9%|9         | 18/200 [00:25&lt;04:17,  1.42s/it]
 10%|9         | 19/200 [00:27&lt;04:16,  1.42s/it]
 10%|#         | 20/200 [00:28&lt;04:15,  1.42s/it]
 10%|#         | 21/200 [00:29&lt;04:13,  1.42s/it]
 11%|#1        | 22/200 [00:31&lt;04:12,  1.42s/it]
 12%|#1        | 23/200 [00:32&lt;04:10,  1.42s/it]
 12%|#2        | 24/200 [00:34&lt;04:09,  1.42s/it]
 12%|#2        | 25/200 [00:35&lt;04:07,  1.42s/it]
 13%|#3        | 26/200 [00:36&lt;04:06,  1.42s/it]
 14%|#3        | 27/200 [00:38&lt;04:05,  1.42s/it]
 14%|#4        | 28/200 [00:39&lt;04:04,  1.42s/it]
 14%|#4        | 29/200 [00:41&lt;04:02,  1.42s/it]
 15%|#5        | 30/200 [00:42&lt;04:01,  1.42s/it]
 16%|#5        | 31/200 [00:44&lt;04:00,  1.42s/it]
 16%|#6        | 32/200 [00:45&lt;03:58,  1.42s/it]
 16%|#6        | 33/200 [00:46&lt;03:57,  1.42s/it]
 17%|#7        | 34/200 [00:48&lt;03:55,  1.42s/it]
 18%|#7        | 35/200 [00:49&lt;03:55,  1.42s/it]
 18%|#8        | 36/200 [00:51&lt;03:52,  1.42s/it]
 18%|#8        | 37/200 [00:52&lt;03:51,  1.42s/it]
 19%|#9        | 38/200 [00:54&lt;03:50,  1.42s/it]
 20%|#9        | 39/200 [00:55&lt;03:48,  1.42s/it]
 20%|##        | 40/200 [00:56&lt;03:47,  1.42s/it]
 20%|##        | 41/200 [00:58&lt;03:45,  1.42s/it]
 21%|##1       | 42/200 [00:59&lt;03:44,  1.42s/it]
 22%|##1       | 43/200 [01:01&lt;03:42,  1.42s/it]
 22%|##2       | 44/200 [01:02&lt;03:41,  1.42s/it]
 22%|##2       | 45/200 [01:03&lt;03:39,  1.42s/it]
 23%|##3       | 46/200 [01:05&lt;03:38,  1.42s/it]
 24%|##3       | 47/200 [01:06&lt;03:37,  1.42s/it]
 24%|##4       | 48/200 [01:08&lt;03:35,  1.42s/it]
 24%|##4       | 49/200 [01:09&lt;03:34,  1.42s/it]
 25%|##5       | 50/200 [01:11&lt;03:32,  1.42s/it]
 26%|##5       | 51/200 [01:12&lt;03:31,  1.42s/it]
 26%|##6       | 52/200 [01:13&lt;03:30,  1.42s/it]
 26%|##6       | 53/200 [01:15&lt;03:28,  1.42s/it]
 27%|##7       | 54/200 [01:16&lt;03:27,  1.42s/it]
 28%|##7       | 55/200 [01:18&lt;03:25,  1.42s/it]
 28%|##8       | 56/200 [01:19&lt;03:24,  1.42s/it]
 28%|##8       | 57/200 [01:20&lt;03:22,  1.42s/it]
 29%|##9       | 58/200 [01:22&lt;03:21,  1.42s/it]
 30%|##9       | 59/200 [01:23&lt;03:19,  1.42s/it]
 30%|###       | 60/200 [01:25&lt;03:18,  1.41s/it]
 30%|###       | 61/200 [01:26&lt;03:16,  1.41s/it]
 31%|###1      | 62/200 [01:28&lt;03:14,  1.41s/it]
 32%|###1      | 63/200 [01:29&lt;03:13,  1.41s/it]
 32%|###2      | 64/200 [01:30&lt;03:11,  1.41s/it]
 32%|###2      | 65/200 [01:32&lt;03:10,  1.41s/it]
 33%|###3      | 66/200 [01:33&lt;03:09,  1.41s/it]
 34%|###3      | 67/200 [01:35&lt;03:07,  1.41s/it]
 34%|###4      | 68/200 [01:36&lt;03:06,  1.42s/it]
 34%|###4      | 69/200 [01:37&lt;03:05,  1.42s/it]
 35%|###5      | 70/200 [01:39&lt;03:04,  1.42s/it]
 36%|###5      | 71/200 [01:40&lt;03:02,  1.42s/it]
 36%|###6      | 72/200 [01:42&lt;03:01,  1.42s/it]
 36%|###6      | 73/200 [01:43&lt;02:59,  1.42s/it]
 37%|###7      | 74/200 [01:45&lt;02:58,  1.42s/it]
 38%|###7      | 75/200 [01:46&lt;02:56,  1.41s/it]
 38%|###8      | 76/200 [01:47&lt;02:55,  1.41s/it]
 38%|###8      | 77/200 [01:49&lt;02:54,  1.42s/it]
 39%|###9      | 78/200 [01:50&lt;02:53,  1.42s/it]
 40%|###9      | 79/200 [01:52&lt;02:51,  1.42s/it]
 40%|####      | 80/200 [01:53&lt;02:50,  1.42s/it]
 40%|####      | 81/200 [01:54&lt;02:48,  1.42s/it]
 41%|####1     | 82/200 [01:56&lt;02:47,  1.42s/it]
 42%|####1     | 83/200 [01:57&lt;02:45,  1.41s/it]
 42%|####2     | 84/200 [01:59&lt;02:43,  1.41s/it]
 42%|####2     | 85/200 [02:00&lt;02:42,  1.41s/it]
 43%|####3     | 86/200 [02:02&lt;02:41,  1.41s/it]
 44%|####3     | 87/200 [02:03&lt;02:39,  1.42s/it]
 44%|####4     | 88/200 [02:04&lt;02:38,  1.42s/it]
 44%|####4     | 89/200 [02:06&lt;02:37,  1.41s/it]
 45%|####5     | 90/200 [02:07&lt;02:35,  1.41s/it]
 46%|####5     | 91/200 [02:09&lt;02:34,  1.42s/it]
 46%|####6     | 92/200 [02:10&lt;02:32,  1.42s/it]
 46%|####6     | 93/200 [02:11&lt;02:31,  1.41s/it]
 47%|####6     | 94/200 [02:13&lt;02:29,  1.41s/it]
 48%|####7     | 95/200 [02:14&lt;02:28,  1.41s/it]
 48%|####8     | 96/200 [02:16&lt;02:26,  1.41s/it]
 48%|####8     | 97/200 [02:17&lt;02:25,  1.41s/it]
 49%|####9     | 98/200 [02:18&lt;02:24,  1.42s/it]
 50%|####9     | 99/200 [02:20&lt;02:22,  1.42s/it]
 50%|#####     | 100/200 [02:21&lt;02:21,  1.42s/it]
 50%|#####     | 101/200 [02:23&lt;02:20,  1.42s/it]
 51%|#####1    | 102/200 [02:24&lt;02:18,  1.42s/it]
 52%|#####1    | 103/200 [02:26&lt;02:17,  1.41s/it]
 52%|#####2    | 104/200 [02:27&lt;02:15,  1.41s/it]
 52%|#####2    | 105/200 [02:28&lt;02:14,  1.41s/it]
 53%|#####3    | 106/200 [02:30&lt;02:12,  1.41s/it]
 54%|#####3    | 107/200 [02:31&lt;02:11,  1.42s/it]
 54%|#####4    | 108/200 [02:33&lt;02:10,  1.42s/it]
 55%|#####4    | 109/200 [02:34&lt;02:08,  1.41s/it]
 55%|#####5    | 110/200 [02:35&lt;02:07,  1.41s/it]
 56%|#####5    | 111/200 [02:37&lt;02:05,  1.41s/it]
 56%|#####6    | 112/200 [02:38&lt;02:04,  1.42s/it]
 56%|#####6    | 113/200 [02:40&lt;02:03,  1.42s/it]
 57%|#####6    | 114/200 [02:41&lt;02:01,  1.42s/it]
 57%|#####7    | 115/200 [02:43&lt;02:00,  1.42s/it]
 58%|#####8    | 116/200 [02:44&lt;01:59,  1.42s/it]
 58%|#####8    | 117/200 [02:45&lt;01:57,  1.42s/it]
 59%|#####8    | 118/200 [02:47&lt;01:55,  1.41s/it]
 60%|#####9    | 119/200 [02:48&lt;01:54,  1.42s/it]
 60%|######    | 120/200 [02:50&lt;01:53,  1.42s/it]
 60%|######    | 121/200 [02:51&lt;01:51,  1.42s/it]
 61%|######1   | 122/200 [02:52&lt;01:50,  1.41s/it]
 62%|######1   | 123/200 [02:54&lt;01:49,  1.42s/it]
 62%|######2   | 124/200 [02:55&lt;01:47,  1.41s/it]
 62%|######2   | 125/200 [02:57&lt;01:45,  1.41s/it]
 63%|######3   | 126/200 [02:58&lt;01:44,  1.41s/it]
 64%|######3   | 127/200 [03:00&lt;01:43,  1.42s/it]
 64%|######4   | 128/200 [03:01&lt;01:42,  1.42s/it]
 64%|######4   | 129/200 [03:02&lt;01:40,  1.42s/it]
 65%|######5   | 130/200 [03:04&lt;01:39,  1.42s/it]
 66%|######5   | 131/200 [03:05&lt;01:37,  1.41s/it]
 66%|######6   | 132/200 [03:07&lt;01:36,  1.41s/it]
 66%|######6   | 133/200 [03:08&lt;01:34,  1.41s/it]
 67%|######7   | 134/200 [03:09&lt;01:33,  1.41s/it]
 68%|######7   | 135/200 [03:11&lt;01:31,  1.41s/it]
 68%|######8   | 136/200 [03:12&lt;01:30,  1.41s/it]
 68%|######8   | 137/200 [03:14&lt;01:29,  1.41s/it]
 69%|######9   | 138/200 [03:15&lt;01:27,  1.41s/it]
 70%|######9   | 139/200 [03:17&lt;01:26,  1.41s/it]
 70%|#######   | 140/200 [03:18&lt;01:24,  1.41s/it]
 70%|#######   | 141/200 [03:19&lt;01:23,  1.41s/it]
 71%|#######1  | 142/200 [03:21&lt;01:21,  1.41s/it]
 72%|#######1  | 143/200 [03:22&lt;01:20,  1.41s/it]
 72%|#######2  | 144/200 [03:24&lt;01:18,  1.41s/it]
 72%|#######2  | 145/200 [03:25&lt;01:17,  1.41s/it]
 73%|#######3  | 146/200 [03:26&lt;01:16,  1.41s/it]
 74%|#######3  | 147/200 [03:28&lt;01:14,  1.41s/it]
 74%|#######4  | 148/200 [03:29&lt;01:13,  1.41s/it]
 74%|#######4  | 149/200 [03:31&lt;01:11,  1.41s/it]
 75%|#######5  | 150/200 [03:32&lt;01:10,  1.41s/it]
 76%|#######5  | 151/200 [03:33&lt;01:09,  1.41s/it]
 76%|#######6  | 152/200 [03:35&lt;01:07,  1.41s/it]
 76%|#######6  | 153/200 [03:36&lt;01:06,  1.41s/it]
 77%|#######7  | 154/200 [03:38&lt;01:04,  1.41s/it]
 78%|#######7  | 155/200 [03:39&lt;01:03,  1.41s/it]
 78%|#######8  | 156/200 [03:40&lt;01:02,  1.41s/it]
 78%|#######8  | 157/200 [03:42&lt;01:00,  1.41s/it]
 79%|#######9  | 158/200 [03:43&lt;00:59,  1.41s/it]
 80%|#######9  | 159/200 [03:45&lt;00:57,  1.41s/it]
 80%|########  | 160/200 [03:46&lt;00:56,  1.41s/it]
 80%|########  | 161/200 [03:48&lt;00:54,  1.41s/it]
 81%|########1 | 162/200 [03:49&lt;00:53,  1.41s/it]
 82%|########1 | 163/200 [03:50&lt;00:52,  1.41s/it]
 82%|########2 | 164/200 [03:52&lt;00:50,  1.41s/it]
 82%|########2 | 165/200 [03:53&lt;00:49,  1.41s/it]
 83%|########2 | 166/200 [03:55&lt;00:48,  1.41s/it]
 84%|########3 | 167/200 [03:56&lt;00:46,  1.41s/it]
 84%|########4 | 168/200 [03:57&lt;00:45,  1.41s/it]
 84%|########4 | 169/200 [03:59&lt;00:43,  1.41s/it]
 85%|########5 | 170/200 [04:00&lt;00:42,  1.41s/it]
 86%|########5 | 171/200 [04:02&lt;00:40,  1.41s/it]
 86%|########6 | 172/200 [04:03&lt;00:39,  1.41s/it]
 86%|########6 | 173/200 [04:04&lt;00:38,  1.41s/it]
 87%|########7 | 174/200 [04:06&lt;00:36,  1.41s/it]
 88%|########7 | 175/200 [04:07&lt;00:35,  1.41s/it]
 88%|########8 | 176/200 [04:09&lt;00:33,  1.41s/it]
 88%|########8 | 177/200 [04:10&lt;00:32,  1.41s/it]
 89%|########9 | 178/200 [04:12&lt;00:31,  1.41s/it]
 90%|########9 | 179/200 [04:13&lt;00:29,  1.41s/it]
 90%|######### | 180/200 [04:14&lt;00:28,  1.41s/it]
 90%|######### | 181/200 [04:16&lt;00:26,  1.41s/it]
 91%|#########1| 182/200 [04:17&lt;00:25,  1.41s/it]
 92%|#########1| 183/200 [04:19&lt;00:24,  1.41s/it]
 92%|#########2| 184/200 [04:20&lt;00:22,  1.41s/it]
 92%|#########2| 185/200 [04:21&lt;00:21,  1.41s/it]
 93%|#########3| 186/200 [04:23&lt;00:19,  1.41s/it]
 94%|#########3| 187/200 [04:24&lt;00:18,  1.41s/it]
 94%|#########3| 188/200 [04:26&lt;00:16,  1.41s/it]
 94%|#########4| 189/200 [04:27&lt;00:15,  1.41s/it]
 95%|#########5| 190/200 [04:28&lt;00:14,  1.41s/it]
 96%|#########5| 191/200 [04:30&lt;00:12,  1.41s/it]
 96%|#########6| 192/200 [04:31&lt;00:11,  1.41s/it]
 96%|#########6| 193/200 [04:33&lt;00:09,  1.41s/it]
 97%|#########7| 194/200 [04:34&lt;00:08,  1.41s/it]
 98%|#########7| 195/200 [04:36&lt;00:07,  1.41s/it]
 98%|#########8| 196/200 [04:37&lt;00:05,  1.42s/it]
 98%|#########8| 197/200 [04:38&lt;00:04,  1.42s/it]
 99%|#########9| 198/200 [04:40&lt;00:02,  1.42s/it]
100%|#########9| 199/200 [04:41&lt;00:01,  1.42s/it]
100%|##########| 200/200 [04:43&lt;00:00,  1.41s/it]
100%|##########| 200/200 [04:43&lt;00:00,  1.42s/it]

  0%|          | 0/200 [00:00&lt;?, ?it/s]
  0%|          | 1/200 [00:00&lt;00:38,  5.20it/s]
  2%|1         | 3/200 [00:00&lt;00:17, 11.25it/s]
  2%|2         | 5/200 [00:00&lt;00:13, 14.20it/s]
  4%|3         | 7/200 [00:00&lt;00:12, 15.55it/s]
  4%|4         | 9/200 [00:00&lt;00:11, 16.76it/s]
  6%|5         | 11/200 [00:00&lt;00:10, 17.45it/s]
  6%|6         | 13/200 [00:00&lt;00:10, 17.99it/s]
  8%|7         | 15/200 [00:00&lt;00:10, 18.28it/s]
  8%|8         | 17/200 [00:01&lt;00:10, 18.14it/s]
 10%|9         | 19/200 [00:01&lt;00:09, 18.26it/s]
 10%|#         | 21/200 [00:01&lt;00:09, 18.34it/s]
 12%|#1        | 23/200 [00:01&lt;00:09, 18.27it/s]
 12%|#2        | 25/200 [00:01&lt;00:09, 18.55it/s]
 14%|#3        | 27/200 [00:01&lt;00:09, 18.76it/s]
 14%|#4        | 29/200 [00:01&lt;00:08, 19.01it/s]
 16%|#5        | 31/200 [00:01&lt;00:09, 18.75it/s]
 16%|#6        | 33/200 [00:01&lt;00:09, 18.22it/s]
 18%|#7        | 35/200 [00:02&lt;00:08, 18.35it/s]
 18%|#8        | 37/200 [00:02&lt;00:08, 18.41it/s]
 20%|#9        | 39/200 [00:02&lt;00:08, 18.76it/s]
 20%|##        | 41/200 [00:02&lt;00:08, 18.79it/s]
 22%|##1       | 43/200 [00:02&lt;00:08, 18.60it/s]
 22%|##2       | 45/200 [00:02&lt;00:08, 18.40it/s]
 24%|##3       | 47/200 [00:02&lt;00:08, 18.26it/s]
 24%|##4       | 49/200 [00:02&lt;00:08, 18.19it/s]
 26%|##5       | 51/200 [00:02&lt;00:08, 18.41it/s]
 26%|##6       | 53/200 [00:02&lt;00:08, 18.04it/s]
 28%|##7       | 55/200 [00:03&lt;00:08, 17.60it/s]
 28%|##8       | 57/200 [00:03&lt;00:07, 18.04it/s]
 30%|##9       | 59/200 [00:03&lt;00:07, 18.26it/s]
 30%|###       | 61/200 [00:03&lt;00:07, 18.47it/s]
 32%|###1      | 63/200 [00:03&lt;00:07, 18.48it/s]
 32%|###2      | 65/200 [00:03&lt;00:07, 18.36it/s]
 34%|###3      | 67/200 [00:03&lt;00:07, 18.43it/s]
 34%|###4      | 69/200 [00:03&lt;00:07, 18.56it/s]
 36%|###5      | 71/200 [00:03&lt;00:06, 18.74it/s]
 36%|###6      | 73/200 [00:04&lt;00:06, 18.81it/s]
 38%|###7      | 75/200 [00:04&lt;00:06, 18.63it/s]
 38%|###8      | 77/200 [00:04&lt;00:06, 18.80it/s]
 40%|###9      | 79/200 [00:04&lt;00:06, 18.81it/s]
 40%|####      | 81/200 [00:04&lt;00:06, 18.93it/s]
 42%|####1     | 83/200 [00:04&lt;00:06, 19.15it/s]
 42%|####2     | 85/200 [00:04&lt;00:06, 19.15it/s]
 44%|####3     | 87/200 [00:04&lt;00:05, 18.96it/s]
 44%|####4     | 89/200 [00:04&lt;00:05, 18.91it/s]
 46%|####5     | 91/200 [00:05&lt;00:05, 18.50it/s]
 46%|####6     | 93/200 [00:05&lt;00:05, 18.73it/s]
 48%|####7     | 95/200 [00:05&lt;00:05, 18.86it/s]
 48%|####8     | 97/200 [00:05&lt;00:05, 18.53it/s]
 50%|####9     | 99/200 [00:05&lt;00:05, 18.64it/s]
 50%|#####     | 101/200 [00:05&lt;00:05, 18.40it/s]
 52%|#####1    | 103/200 [00:05&lt;00:05, 18.64it/s]
 52%|#####2    | 105/200 [00:05&lt;00:05, 18.61it/s]
 54%|#####3    | 107/200 [00:05&lt;00:04, 18.60it/s]
 55%|#####4    | 109/200 [00:05&lt;00:04, 18.86it/s]
 56%|#####5    | 111/200 [00:06&lt;00:04, 18.98it/s]
 56%|#####6    | 113/200 [00:06&lt;00:04, 18.85it/s]
 57%|#####7    | 115/200 [00:06&lt;00:04, 18.84it/s]
 58%|#####8    | 117/200 [00:06&lt;00:04, 18.47it/s]
 60%|#####9    | 119/200 [00:06&lt;00:04, 18.28it/s]
 60%|######    | 121/200 [00:06&lt;00:04, 18.41it/s]
 62%|######1   | 123/200 [00:06&lt;00:04, 18.28it/s]
 62%|######2   | 125/200 [00:06&lt;00:04, 18.64it/s]
 64%|######3   | 127/200 [00:06&lt;00:03, 18.70it/s]
 64%|######4   | 129/200 [00:07&lt;00:03, 18.64it/s]
 66%|######5   | 131/200 [00:07&lt;00:03, 18.72it/s]
 66%|######6   | 133/200 [00:07&lt;00:03, 18.54it/s]
 68%|######7   | 135/200 [00:07&lt;00:03, 18.32it/s]
 68%|######8   | 137/200 [00:07&lt;00:03, 18.13it/s]
 70%|######9   | 139/200 [00:07&lt;00:03, 17.66it/s]
 70%|#######   | 141/200 [00:07&lt;00:03, 17.99it/s]
 72%|#######1  | 143/200 [00:07&lt;00:03, 18.22it/s]
 72%|#######2  | 145/200 [00:07&lt;00:03, 17.93it/s]
 74%|#######3  | 147/200 [00:08&lt;00:02, 17.98it/s]
 74%|#######4  | 149/200 [00:08&lt;00:02, 17.98it/s]
 76%|#######5  | 151/200 [00:08&lt;00:02, 18.25it/s]
 76%|#######6  | 153/200 [00:08&lt;00:02, 18.51it/s]
 78%|#######7  | 155/200 [00:08&lt;00:02, 18.57it/s]
 78%|#######8  | 157/200 [00:08&lt;00:02, 18.39it/s]
 80%|#######9  | 159/200 [00:08&lt;00:02, 18.62it/s]
 80%|########  | 161/200 [00:08&lt;00:02, 18.72it/s]
 82%|########1 | 163/200 [00:08&lt;00:01, 18.77it/s]
 82%|########2 | 165/200 [00:09&lt;00:01, 18.56it/s]
 84%|########3 | 167/200 [00:09&lt;00:01, 18.77it/s]
 84%|########4 | 169/200 [00:09&lt;00:01, 18.81it/s]
 86%|########5 | 171/200 [00:09&lt;00:01, 18.71it/s]
 86%|########6 | 173/200 [00:09&lt;00:01, 18.77it/s]
 88%|########7 | 175/200 [00:09&lt;00:01, 18.83it/s]
 88%|########8 | 177/200 [00:09&lt;00:01, 18.93it/s]
 90%|########9 | 179/200 [00:09&lt;00:01, 18.70it/s]
 90%|######### | 181/200 [00:09&lt;00:01, 18.75it/s]
 92%|#########1| 183/200 [00:09&lt;00:00, 18.64it/s]
 92%|#########2| 185/200 [00:10&lt;00:00, 18.84it/s]
 94%|#########3| 187/200 [00:10&lt;00:00, 18.94it/s]
 94%|#########4| 189/200 [00:10&lt;00:00, 19.15it/s]
 96%|#########5| 191/200 [00:10&lt;00:00, 18.97it/s]
 96%|#########6| 193/200 [00:10&lt;00:00, 18.72it/s]
 98%|#########7| 195/200 [00:10&lt;00:00, 18.84it/s]
 98%|#########8| 197/200 [00:10&lt;00:00, 18.51it/s]
100%|#########9| 199/200 [00:10&lt;00:00, 18.07it/s]
100%|##########| 200/200 [00:10&lt;00:00, 18.32it/s]
</pre></div>
</div>
</section>
<section id="view-the-class-averages">
<h2>View the Class Averages<a class="headerlink" href="#view-the-class-averages" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show class averages</span>
<span class="n">avgs</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_pipeline_demo_005.png" srcset="../_images/sphx_glr_pipeline_demo_005.png" alt="pipeline demo" class = "sphx-glr-single-img"/><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show original images corresponding to those classes. This 1:1 comparison is only expected to</span>
<span class="c1"># work because we used ``TopClassSelector`` to classify our images.</span>
<span class="n">src</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_pipeline_demo_006.png" srcset="../_images/sphx_glr_pipeline_demo_006.png" alt="pipeline demo" class = "sphx-glr-single-img"/></section>
<section id="orientation-estimation">
<h2>Orientation Estimation<a class="headerlink" href="#orientation-estimation" title="Permalink to this headline">¶</a></h2>
<p>We initialize a <code class="docutils literal notranslate"><span class="pre">CLSyncVoting</span></code> class instance for estimating the orientations of the images.
The estimation employs the common lines method with synchronization and voting.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aspire.abinitio</span> <span class="kn">import</span> <span class="n">CLSyncVoting</span>

<span class="c1"># Stash true rotations for later comparison</span>
<span class="n">true_rotations</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">rotations</span><span class="p">[:</span><span class="n">n_classes</span><span class="p">]</span>

<span class="n">orient_est</span> <span class="o">=</span> <span class="n">CLSyncVoting</span><span class="p">(</span><span class="n">avgs</span><span class="p">,</span> <span class="n">n_theta</span><span class="o">=</span><span class="mi">72</span><span class="p">)</span>

<span class="c1"># Get the estimated rotations</span>
<span class="n">orient_est</span><span class="o">.</span><span class="n">estimate_rotations</span><span class="p">()</span>
<span class="n">rots_est</span> <span class="o">=</span> <span class="n">orient_est</span><span class="o">.</span><span class="n">rotations</span>
</pre></div>
</div>
</section>
<section id="mean-squared-error">
<h2>Mean Squared Error<a class="headerlink" href="#mean-squared-error" title="Permalink to this headline">¶</a></h2>
<p>ASIPRE has some built-in utility functions for globally aligning the estimated rotations
to the true rotations and computing the mean squared error.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aspire.utils.coor_trans</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">get_aligned_rotations</span><span class="p">,</span>
    <span class="n">get_rots_mse</span><span class="p">,</span>
    <span class="n">register_rotations</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Compare with known true rotations</span>
<span class="n">Q_mat</span><span class="p">,</span> <span class="n">flag</span> <span class="o">=</span> <span class="n">register_rotations</span><span class="p">(</span><span class="n">rots_est</span><span class="p">,</span> <span class="n">true_rotations</span><span class="p">)</span>
<span class="n">regrot</span> <span class="o">=</span> <span class="n">get_aligned_rotations</span><span class="p">(</span><span class="n">rots_est</span><span class="p">,</span> <span class="n">Q_mat</span><span class="p">,</span> <span class="n">flag</span><span class="p">)</span>
<span class="n">mse_reg</span> <span class="o">=</span> <span class="n">get_rots_mse</span><span class="p">(</span><span class="n">regrot</span><span class="p">,</span> <span class="n">true_rotations</span><span class="p">)</span>
<span class="n">mse_reg</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>0.03823770680337834
</pre></div>
</div>
</section>
<section id="volume-reconstruction">
<h2>Volume Reconstruction<a class="headerlink" href="#volume-reconstruction" title="Permalink to this headline">¶</a></h2>
<p>Now that we have our class averages and rotation estimates, we can estimate the
mean volume by supplying the class averages and basis for back projection.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aspire.basis</span> <span class="kn">import</span> <span class="n">FFBBasis3D</span>
<span class="kn">from</span> <span class="nn">aspire.reconstruction</span> <span class="kn">import</span> <span class="n">MeanEstimator</span>

<span class="c1"># Assign the estimated rotations to the class averages</span>
<span class="n">avgs</span><span class="o">.</span><span class="n">rotations</span> <span class="o">=</span> <span class="n">rots_est</span>

<span class="c1"># Create a reasonable Basis for the 3d Volume</span>
<span class="n">basis</span> <span class="o">=</span> <span class="n">FFBBasis3D</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">vol</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

<span class="c1"># Setup an estimator to perform the back projection.</span>
<span class="n">estimator</span> <span class="o">=</span> <span class="n">MeanEstimator</span><span class="p">(</span><span class="n">avgs</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>

<span class="c1"># Perform the estimation and save the volume.</span>
<span class="n">estimated_volume</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">estimate</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="comparison-of-estimated-volume-with-source-volume">
<h2>Comparison of Estimated Volume with Source Volume<a class="headerlink" href="#comparison-of-estimated-volume-with-source-volume" title="Permalink to this headline">¶</a></h2>
<p>To get a visual confirmation that our results are sane, we rotate the
estimated volume by the estimated rotations and project along the z-axis.
These estimated projections should align with the original projection images.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aspire.source</span> <span class="kn">import</span> <span class="n">ArrayImageSource</span>

<span class="c1"># Get projections from the estimated volume using the estimated orientations.</span>
<span class="c1"># We instantiate the projections as an ``ArrayImageSource`` to access the ``Image.show()`` method.</span>
<span class="n">projections_est</span> <span class="o">=</span> <span class="n">ArrayImageSource</span><span class="p">(</span><span class="n">estimated_volume</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">rots_est</span><span class="p">))</span>

<span class="c1"># We view the first 10 projections of the estimated volume.</span>
<span class="n">projections_est</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_pipeline_demo_007.png" srcset="../_images/sphx_glr_pipeline_demo_007.png" alt="pipeline demo" class = "sphx-glr-single-img"/><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># For comparison, we view the first 10 source projections.</span>
<span class="n">src</span><span class="o">.</span><span class="n">projections</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_pipeline_demo_008.png" srcset="../_images/sphx_glr_pipeline_demo_008.png" alt="pipeline demo" class = "sphx-glr-single-img"/><p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 10 minutes  44.448 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-tutorials-pipeline-demo-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/295b04456c31e136eefc8b736de1e0a4/pipeline_demo.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">pipeline_demo.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/9b821c495445535e6775308a42eb84d7/pipeline_demo.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">pipeline_demo.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="lecture_feature_demo.html" class="btn btn-neutral float-left" title="ASPIRE-Python Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="apple_picker.html" class="btn btn-neutral float-right" title="Apple Picker" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Princeton University.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>